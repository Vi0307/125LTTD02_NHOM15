<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTOTECH - Chatbox</title>
    <link rel="stylesheet" href="asset/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="dashboard-body admin-body">

<div class="page-wrapper">

    <!-- Top User -->
    <div class="top-user">
        <span class="username">Administrator</span>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <ul class="menu">
            <li class="menu-item" onclick="goTo('product1.html')"><i class="fas fa-th-large"></i> Sản phẩm</li>
            <li class="menu-item" onclick="goTo('user.html')"><i class="fas fa-users"></i> Người dùng</li>
            <li class="menu-item" onclick="goTo('order.html')"><i class="fas fa-shopping-cart"></i> Đơn hàng</li>
            <li class="menu-item" onclick="goTo('schedule.html')"><i class="fas fa-calendar-check"></i> Đặt lịch</li>
            <li class="menu-item" onclick="goTo('notifications.html')"><i class="fas fa-bell"></i> Thông báo</li>
            <li class="menu-item active"><i class="fas fa-comments"></i> Chatbox</li>
        </ul>
    </aside>

    <!-- Main Content: Chatbox -->
    <main class="admin-main chatbox-main">
        
        <!-- Danh sách khách hàng (bên trái) -->
        <div class="chat-users">
            <div class="chat-header">
                <h3>Trực tuyến</h3>
            </div>
            <div class="users-list">
                <div class="user-item active" onclick="openChat(this, 'Nguyễn Văn A')">
                    <div class="user-avatar">NVA</div>
                    <div class="user-info">
                        <div class="user-name">Nguyễn Văn A</div>
                        <div class="user-last-msg">Tuần trước...</div>
                    </div>
                    <div class="user-online"></div>
                </div>
                <div class="user-item" onclick="openChat(this, 'Trần Thị B')">
                    <div class="user-avatar">TTB</div>
                    <div class="user-info">
                        <div class="user-name">Trần Thị B</div>
                        <div class="user-last-msg">Cần tư vấn phụ tùng</div>
                    </div>
                    <div class="user-online"></div>
                </div>
                <div class="user-item" onclick="openChat(this, 'Lê Minh C')">
                    <div class="user-avatar">LMC</div>
                    <div class="user-info">
                        <div class="user-name">Lê Minh C</div>
                        <div class="user-last-msg">Hỏi về bảo dưỡng</div>
                    </div>
                    <div class="user-online"></div>
                </div>
                <div class="user-item" onclick="openChat(this, 'Phạm Thị D')">
                    <div class="user-avatar">PTD</div>
                    <div class="user-info">
                        <div class="user-name">Phạm Thị D</div>
                        <div class="user-last-msg">Liên hệ đặt lịch</div>
                    </div>
                    <div class="user-online"></div>
                </div>
            </div>
        </div>

        <!-- Khu vực chat (bên phải) -->
        <div class="chat-area">
            <div class="chat-header">
                <div class="chat-user-info">
                    <div class="chat-avatar" id="chatAvatar">NVA</div>
                    <div>
                        <div class="chat-user-name" id="chatUserName">Nguyễn Văn A</div>
                        <div class="chat-status">Đang hoạt động</div>
                    </div>
                </div>
            </div>

            <!-- Tin nhắn -->
            <div class="chat-messages" id="chatMessages">
                <div class="message customer">
                    <div class="message-content">Chào anh, em muốn hỏi về phụ tùng BMW i5 ạ</div>
                    <div class="message-time">10:32</div>
                </div>
                <div class="message admin">
                    <div class="message-content">Chào em! BMW i5 em cần phụ tùng nào ạ? Anh tư vấn ngay</div>
                    <div class="message-time">10:33</div>
                </div>
                <div class="message customer">
                    <div class="message-content">Dạ em cần thay lọc gió động cơ ạ</div>
                    <div class="message-time">10:34</div>
                </div>
            </div>

            <!-- Input chat -->
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Nhập tin nhắn..." onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </main>

    <div class="bottom-brand">
        <div class="brand-name">OTOTECH</div>
        <div class="version">Version: 1.0.0.11</div>
    </div>
</div>

<script>
let currentChatUser = null;

function openChat(userElement, userName) {
    // Đổi active user
    document.querySelectorAll('.user-item').forEach(u => u.classList.remove('active'));
    userElement.classList.add('active');
    currentChatUser = userName;

    // Cập nhật header chat
    const chatUserName = document.getElementById('chatUserName');
    const chatAvatar = document.getElementById('chatAvatar');
    if (chatUserName) chatUserName.textContent = userName;
    if (chatAvatar) {
        // Lấy chữ cái đầu của từng từ
        const initials = userName.split(' ').map(n => n[0]).join('').toUpperCase();
        chatAvatar.textContent = initials;
    }

    // Load tin nhắn mẫu (có thể fetch API)
    loadSampleMessages();
    
    // Scroll tin nhắn xuống cuối
    const messagesDiv = document.getElementById('chatMessages');
    if (messagesDiv) {
        setTimeout(() => {
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }, 100);
    }
}

function goTo(page) {
    window.location.href = page;
}

function loadSampleMessages() {
    const messagesDiv = document.getElementById('chatMessages');
    messagesDiv.innerHTML = `
        <div class="message customer">
            <div class="message-content">Chào anh/chị, em muốn tư vấn về ${currentChatUser === 'Nguyễn Văn A' ? 'phụ tùng BMW i5' : 'bảo dưỡng xe'} ạ</div>
            <div class="message-time">10:32</div>
        </div>
        <div class="message admin">
            <div class="message-content">Chào em! ${currentChatUser === 'Nguyễn Văn A' ? 'BMW i5 em cần phụ tùng nào ạ?' : 'Xe em cần bảo dưỡng gì ạ?'} Anh tư vấn ngay đây!</div>
            <div class="message-time">10:33</div>
        </div>
        <div class="message customer">
            <div class="message-content">${currentChatUser === 'Nguyễn Văn A' ? 'Dạ em cần thay lọc gió động cơ ạ' : 'Dạ em muốn đặt lịch bảo dưỡng ạ'}</div>
            <div class="message-time">10:34</div>
        </div>
    `;
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function sendMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    if (!message) return;

    const messagesDiv = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message admin';
    messageDiv.innerHTML = `
        <div class="message-content">${message}</div>
        <div class="message-time">${new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'})}</div>
    `;
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
    input.value = '';
}

function handleKeyPress(event) {
    if (event.key === 'Enter') {
        sendMessage();
    }
}
</script>

</body>
</html>