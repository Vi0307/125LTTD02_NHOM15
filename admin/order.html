<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTOTECH - Đơn hàng</title>
    <link rel="stylesheet" href="asset/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="dashboard-body admin-body">

<div class="page-wrapper">

    <!-- Top User -->
    <div class="top-user">
        <span class="username">Administrator</span>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <ul class="menu">
            <li class="menu-item" onclick="goTo('dashboard.html')">
                <i class="fas fa-th-large"></i> Sản phẩm
            </li>
            <li class="menu-item" onclick="goTo('user.html')">
                <i class="fas fa-users"></i> Người dùng
            </li>
            <li class="menu-item active" onclick="goTo('order.html')">
                <i class="fas fa-shopping-cart"></i> Đơn hàng
            </li>
            <li class="menu-item" onclick="goTo('schedule.html')">
                <i class="fas fa-calendar-check"></i> Đặt lịch
            </li>
            <li class="menu-item" onclick="goTo('notifications.html')">
                <i class="fas fa-bell"></i> Thông báo
            </li>
            <li class="menu-item" onclick="goTo('chatbox.html')">
                <i class="fas fa-comments"></i> Chatbox
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <section class="panel-grid">

            <!-- BẢNG ĐƠN HÀNG -->
            <div class="table-card">
                <h2 class="table-title">Đơn Hàng</h2>
                <div class="table-container">
                    <table class="order-table">
                        <thead>
                            <tr>
                                <th>Mã đơn hàng</th>
                                <th>Mã khách hàng</th>
                                <th>Mã phụ tùng</th>
                                <th>Trạng thái</th>
                            </tr>
                        </thead>
                        <tbody id="orderTableBody">
                            <tr onclick="fillOrderForm(this)">
                                <td>DH001</td>
                                <td>KH001</td>
                                <td>X001</td>
                                <td><span class="status completed">Đã hoàn thành</span></td>
                            </tr>
                            <tr onclick="fillOrderForm(this)">
                                <td>DH002</td>
                                <td>KH002</td>
                                <td>X002</td>
                                <td><span class="status pending">Chưa hoàn thành</span></td>
                            </tr>
                            <tr onclick="fillOrderForm(this)">
                                <td>DH003</td>
                                <td>KH003</td>
                                <td>X005</td>
                                <td><span class="status pending">Chưa hoàn thành</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- FORM CHI TIẾT – HIỆN NGAY DƯỚI BẢNG -->
            <div id="orderDetailCard" class="detail-card">
                <h2 class="detail-title">Đơn hàng</h2>
                <div class="form-grid-order">
                    <div class="form-group"><label>Mã đơn hàng</label><input type="text" id="maDonHang" readonly></div>
                    <div class="form-group"><label>Mã phụ tùng</label><input type="text" id="maPhuTung" readonly></div>
                    <div class="form-group"><label>Tổng tiền</label><input type="text" id="tongTien"></div>
                    <div class="form-group"><label>Mã khách hàng</label><input type="text" id="maKhachHang" readonly></div>
                    <div class="form-group"><label>Tên phụ tùng</label><input type="text" id="tenPhuTung"></div>
                    <div class="form-group"><label>Phương thức thanh toán</label><input type="text" id="phuongThucTT" value="Chuyển khoản"></div>
                    <div class="form-group"><label>Tên khách hàng</label><input type="text" id="tenKhachHang"></div>
                    <div class="form-group"><label>Địa chỉ</label><input type="text" id="diaChi"></div>
                    <div class="form-group"><label>Vận chuyển</label><input type="text" id="vanChuyen" value="Giao hàng tiết kiệm"></div>
                    <div class="form-group"><label>Số lượng</label><input type="number" id="soLuong" min="1" value="1"></div>
                    <div class="form-group"><label>Voucher</label><input type="text" id="voucher"></div>
                    <div class="form-group">
                        <label>Trạng thái</label>
                        <select id="trangThai">
                            <option value="pending">Chưa hoàn thành</option>
                            <option value="completed">Đã hoàn thành</option>
                        </select>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn-update" onclick="updateOrderStatus()">Cập nhật</button>
                </div>
            </div>

        </section>
    </main>

    <div class="bottom-brand">
        <div class="brand-name">OTOTECH</div>
        <div class="version">Version: 1.0.0.11</div>
    </div>
</div>

<script>
// Dùng var hoặc kiểm tra tồn tại để tránh lỗi redeclare
var currentOrderRow = null;

function fillOrderForm(row) {
    currentOrderRow = row;
    const c = row.cells;

    const detailCard = document.getElementById('orderDetailCard');
    detailCard.style.display = 'block';

    // Điền dữ liệu cơ bản
    $('#maDonHang').value     = c[0].textContent.trim();
    $('#maKhachHang').value   = c[1].textContent.trim();
    $('#maPhuTung').value     = c[2].textContent.trim();

    // Dữ liệu mẫu (có thể thay bằng fetch API sau)
    const sampleData = {
        'X001': { ten: 'Ống gió nạp hơi',      tien: '7.000.000VND', tenKH: 'Nguyễn Văn A' },
        'X002': { ten: 'Bộ đèn pha',          tien: '7.500.000VND', tenKH: 'Trần Thị B' },
        'X005': { ten: 'Lọc gió động cơ',     tien: '1.200.000VND', tenKH: 'Lê Văn C' }
    };
    const info = sampleData[c[2].textContent.trim()] || { ten: '', tien: '', tenKH: '' };

    $('#tenPhuTung').value    = info.ten;
    $('#tongTien').value      = info.tien;
    $('#tenKhachHang').value  = info.tenKH;
    $('#diaChi').value        = '123 Đường Láng, Hà Nội';
    $('#soLuong').value       = 1;
    $('#voucher').value       = '';
    $('#vanChuyen').value     = 'Giao hàng tiết kiệm';
    $('#phuongThucTT').value  = 'Chuyển khoản';

    // Trạng thái
    const isCompleted = c[3].querySelector('span').textContent.includes('Đã');
    $('#trangThai').value = isCompleted ? 'completed' : 'pending';

    // Cuộn mượt đến form
    detailCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function updateOrderStatus() {
    if (!currentOrderRow) {
        alert('Vui lòng chọn đơn hàng trước!');
        return;
    }

    const statusValue = $('#trangThai').value;
    const statusText  = statusValue === 'completed' ? 'Đã hoàn thành' : 'Chưa hoàn thành';
    const span = currentOrderRow.cells[3].querySelector('span');

    span.textContent = statusText;
    span.className = 'status ' + statusValue;

    alert('Cập nhật trạng thái thành công!');
}

// Helper ngắn gọn
function $(selector) {
    return document.querySelector(selector);
}

function goTo(page) {
            window.location.href = page;
        }
</script>
</body>
</html>