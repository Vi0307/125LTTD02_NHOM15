<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTOTECH - Intelligent Service</title>

    <!-- CSS -->
    <link rel="stylesheet" href="asset/style.css">

    <!-- Font Awesome Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <div class="login-container">

        <!-- Logo -->
        <div class="logo">
            <h1>OTOTECH</h1>
            <p>Intelligent Service</p>
        </div>

        <!-- Icon xe h∆°i -->
        <div class="car-icon">
            <img src="asset/car-icon.png" alt="Car Icon">
        </div>

        <!-- Ch√†o m·ª´ng -->
        <h2 class="welcome-text">Ch√†o m·ª´ng quay tr·ªü l·∫°i !</h2>

        <!-- Form ƒëƒÉng nh·∫≠p -->
        <form>
            <!-- Name -->
            <div class="form-group">
                <label>T√™n ƒëƒÉng nh·∫≠p</label>
                <div class="input-wrapper">
                    <input type="text" placeholder="Nh·∫≠p t√™n admin" id="admin">
                </div>
            </div>

            <!-- Password -->
            <div class="form-group">
                <label>M·∫≠t kh·∫©u</label>
                <div class="input-wrapper">
                    <input type="password" placeholder="Password" id="password">
                    <i class="fas fa-eye-slash eye-icon" id="togglePassword"></i>
                </div>
            </div>

            <!-- N∆°i ch·ªØa im (ghi nh·ªõ ƒëƒÉng nh·∫≠p) -->
            <div class="remember-wrapper">
                <input type="checkbox" id="remember">
                <label for="remember">Ghi nh·ªõ ƒëƒÉng nh·∫≠p</label>
            </div>

            <!-- Th√¥ng b√°o l·ªói -->
            <div id="error-message" class="error-message" style="display: none;"></div>

            <button type="button" class="login-btn" id="loginBtn">
                ƒêƒÇNG NH·∫¨P
            </button>

        </form>
    </div>

    <!-- API Service -->
    <script src="asset/api.js"></script>
    
    <!-- JS Toggle M·∫≠t kh·∫©u & X·ª≠ l√Ω ƒëƒÉng nh·∫≠p -->
    <script>
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');

        // Toggle hi·ªÉn th·ªã m·∫≠t kh·∫©u
        togglePassword.addEventListener('click', function () {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);

            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o l·ªói
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            // T·ª± ƒë·ªông ·∫©n sau 5 gi√¢y
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // H√†m ·∫©n th√¥ng b√°o l·ªói
        function hideError() {
            document.getElementById('error-message').style.display = 'none';
        }

        // H√†m x·ª≠ l√Ω ƒëƒÉng nh·∫≠p
        async function handleLogin() {
            const adminInput = document.getElementById('admin');
            const passwordInput = document.getElementById('password');
            const loginBtn = document.getElementById('loginBtn');
            const rememberCheckbox = document.getElementById('remember');

            const tenDangNhap = adminInput.value.trim();
            const matKhau = passwordInput.value;

            // Ki·ªÉm tra input r·ªóng
            if (!tenDangNhap || !matKhau) {
                showError('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n ƒëƒÉng nh·∫≠p v√† m·∫≠t kh·∫©u!');
                return;
            }

            // ·∫®n th√¥ng b√°o l·ªói c≈©
            hideError();

            // Disable button v√† hi·ªÉn th·ªã loading
            loginBtn.disabled = true;
            loginBtn.textContent = 'ƒêang x·ª≠ l√Ω...';

            try {
                console.log('üîê B·∫Øt ƒë·∫ßu ƒëƒÉng nh·∫≠p v·ªõi:', { tenDangNhap, hasPassword: !!matKhau });

                // G·ªçi API ƒëƒÉng nh·∫≠p th√¥ng qua AuthService
                const result = await AuthService.login(tenDangNhap, matKhau);

                console.log('üîê K·∫øt qu·∫£ ƒëƒÉng nh·∫≠p:', result);

                // Ki·ªÉm tra k·∫øt qu·∫£ ƒëƒÉng nh·∫≠p
                if (result && result.success === true && result.data && result.data.token) {
                    // ƒêƒÉng nh·∫≠p th√†nh c√¥ng
                    console.log('‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
                    
                    // L∆∞u th√¥ng tin ƒëƒÉng nh·∫≠p n·∫øu ch·ªçn "Ghi nh·ªõ"
                    // Token ƒë√£ ƒë∆∞·ª£c l∆∞u trong AuthService.login()
                    if (rememberCheckbox.checked && result.data.admin) {
                        localStorage.setItem('adminUsername', result.data.admin.tenDangNhap);
                        localStorage.setItem('adminVaiTro', result.data.admin.vaiTro);
                    } else {
                        sessionStorage.setItem('adminUsername', result.data.admin?.tenDangNhap || tenDangNhap);
                    }

                    // Chuy·ªÉn ƒë·∫øn trang dashboard
                    window.location.href = 'dashboard-layout.html';
                } else {
                    // ƒêƒÉng nh·∫≠p th·∫•t b·∫°i
                    const errorMsg = result?.message || 'T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!';
                    showError(errorMsg);
                    
                    // Reset button
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'ƒêƒÇNG NH·∫¨P';
                    
                    // X√≥a m·∫≠t kh·∫©u
                    passwordInput.value = '';
                }
            } catch (error) {
                // X·ª≠ l√Ω l·ªói k·∫øt n·ªëi ho·∫∑c l·ªói kh√°c
                console.error('‚ùå L·ªói ƒëƒÉng nh·∫≠p:', error);
                showError('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra l·∫°i k·∫øt n·ªëi!');
                
                // Reset button
                loginBtn.disabled = false;
                loginBtn.textContent = 'ƒêƒÇNG NH·∫¨P';
            }
        }

        // G·∫Øn s·ª± ki·ªán cho n√∫t ƒëƒÉng nh·∫≠p
        document.addEventListener('DOMContentLoaded', function() {
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.addEventListener('click', handleLogin);

            // Enter ƒë·ªÉ ƒëƒÉng nh·∫≠p
            const passwordInput = document.getElementById('password');
            const adminInput = document.getElementById('admin');

            [adminInput, passwordInput].forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleLogin();
                    }
                });
            });
        });
    </script>
</body>
</html>
