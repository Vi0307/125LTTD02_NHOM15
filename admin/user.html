<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTOTECH - Khách hàng</title>
    <link rel="stylesheet" href="asset/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="dashboard-body admin-body">

<div class="page-wrapper">

    <!-- Top User & Sidebar giữ nguyên -->
    <div class="top-user">
        <img src="https://via.placeholder.com/40/333/fff?text=A" alt="Admin" class="avatar">
        <span class="username">Administrator</span>
    </div>

    <aside class="sidebar">
        <ul class="menu">
            <li class="menu-item"><i class="fas fa-th-large"></i> Sản phẩm</li>
            <li class="menu-item active"><i class="fas fa-users"></i> Người dùng</li>
            <li class="menu-item"><i class="fas fa-shopping-cart"></i> Đơn hàng</li>
            <li class="menu-item"><i class="fas fa-calendar-check"></i> Đặt lịch</li>
            <li class="menu-item"><i class="fas fa-bell"></i> Thông báo</li>
        </ul>
    </aside>

    <main class="admin-main">
        <section class="panel-grid">

            <!-- BẢNG KHÁCH HÀNG -->
            <div class="table-card">
                <h2 class="table-title">Khách hàng</h2>
                <div class="table-container">
                    <table class="user-table">
                        <thead>
                            <tr>
                                <th>Mã khách hàng</th>
                                <th>Tên khách hàng</th>
                                <th>SĐT</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                            <tr onclick="fillUserForm(this)">
                                <td>KH001</td>
                                <td>Hải Phan</td>
                                <td>0999999999</td>
                                <td class="action-icons">
                                    <i class="fas lock-icon" title="Khóa/Mở tài khoản" onclick="lockUser(this)"></i>
                                    <i class="fas fa-trash delete-icon" title="Xóa" onclick="event.stopPropagation(); deleteUser(this)"></i>
                                </td>
                            </tr>
                            <tr onclick="fillUserForm(this)">
                                <td>KH002</td>
                                <td>Vũ Trần</td>
                                <td>0911111111</td>
                                <td class="action-icons">
                                    <i class="fas lock-icon locked" title="Khóa/Mở tài khoản" onclick="lockUser(this)"></i>
                                    <i class="fas fa-trash delete-icon" title="Xóa" onclick="event.stopPropagation(); deleteUser(this)"></i>
                                </td>
                            </tr>
                            <tr onclick="fillUserForm(this)">
                                <td>KH003</td>
                                <td>Minh Anh</td>
                                <td>0901234567</td>
                                <td class="action-icons">
                                    <i class="fas lock-icon" title="Khóa/Mở tài khoản" onclick="lockUser(this)"></i>
                                    <i class="fas fa-trash delete-icon" title="Xóa" onclick="event.stopPropagation(); deleteUser(this)"></i>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- FORM CHI TIẾT -->
            <div id="userDetailCard" class="detail-card">
                <h2 class="detail-title">Chi tiết khách hàng</h2>
                <div class="form-grid-user">

                    <div class="form-group"><label>Mã khách hàng</label><input type="text" id="maKH" readonly></div>
                    <div class="form-group"><label>Loại xe</label><input type="text" id="loaiXe"></div>
                    <div class="form-group"><label>SĐT</label><input type="text" id="sdt"></div>

                    <div class="form-group"><label>Mã xe</label><input type="text" id="maXe"></div>

                    <!-- MẬT KHẨU LUÔN HIỆN ******** -->
                    <div class="form-group">
                        <label>Mật khẩu</label>
                        <input type="text" id="matKhau" value="********" readonly style="color:#666; font-weight:600; letter-spacing:2px;">
                    </div>

                    <!-- SỐ LẦN BẢO DƯỠNG: CHỈ TỪ 0 ĐẾN 6 -->
                    <div class="form-group">
                        <label>Số lần bảo dưỡng</label>
                        <select id="soLanBaoDuong">
                            <option value="0">0 lần</option>
                            <option value="1">1 lần</option>
                            <option value="2">2 lần</option>
                            <option value="3">3 lần</option>
                            <option value="4">4 lần</option>
                            <option value="5">5 lần</option>
                            <option value="6" selected>6 lần</option>
                        </select>
                    </div>

                    <div class="form-group"><label>Tên khách hàng</label><input type="text" id="tenKH"></div>
                    <div class="form-group"><label>Email</label><input type="email" id="email"></div>
                </div>

                <div class="action-buttons">
                    <button class="btn-update" onclick="updateUser()">
                        Cập nhật
                    </button>
                </div>
            </div>

        </section>
    </main>

    <div class="bottom-brand">
        <div class="brand-name">OTOTECH</div>
        <div class="version">Version: 1.0.0.11</div>
    </div>
</div>

<script>
var currentUserRow = null;

function fillUserForm(row) {
    currentUserRow = row;
    const c = row.cells;

    const card = document.getElementById('userDetailCard');
    card.style.display = 'block';

    $('#maKH').value = c[0].textContent.trim();
    $('#tenKH').value = c[1].textContent.trim();
    $('#sdt').value = c[2].textContent.trim();

    const data = {
        'KH001': { loaiXe: 'BMW i5', maXe: '30E-12345', email: 'hai.pham@gmail.com', baoDuong: 3 },
        'KH002': { loaiXe: 'Mercedes EQS', maXe: '51H-67890', email: 'vu.tran@gmail.com', baoDuong: 6 },
        'KH003': { loaiXe: 'Audi e-tron', maXe: '29A-98765', email: 'minh.anh@gmail.com', baoDuong: 1 }
    };
    const info = data[c[0].textContent.trim()] || {};

    $('#loaiXe').value = info.loaiXe || '';
    $('#maXe').value = info.maXe || '';
    $('#email').value = info.email || '';
    $('#soLanBaoDuong').value = info.baoDuong ?? 0;

    card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function lockUser(icon) {
    event.stopPropagation();
    const isLocked = icon.classList.contains('locked');
    const maKH = icon.closest('tr').cells[0].textContent.trim();

    if (isLocked) {
        if (confirm(`Mở khóa tài khoản ${maKH}?`)) {
            icon.classList.remove('locked');
            alert(`Đã mở khóa ${maKH}`);
        }
    } else {
        if (confirm(`Khóa tài khoản ${maKH}?\nKhách hàng sẽ không thể đăng nhập!`)) {
            icon.classList.add('locked');
            alert(`Đã khóa ${maKH}`);
        }
    }
}

function deleteUser(icon) {
    if (confirm('Xóa khách hàng này vĩnh viễn?')) {
        icon.closest('tr').remove();
        document.getElementById('userDetailCard').style.display = 'none';
    }
}

function updateUser() {
    if (!currentUserRow) return alert('Vui lòng chọn khách hàng!');
    const c = currentUserRow.cells;
    c[1].textContent = $('#tenKH').value;
    c[2].textContent = $('#sdt').value;
    alert('Cập nhật thành công!');
}

function $(s) { return document.querySelector(s); }
</script>

</body>
</html>